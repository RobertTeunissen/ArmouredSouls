// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(50)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  role         String   @default("user") @db.VarChar(20)
  currency     Int      @default(1000000)
  elo          Int      @default(1200)
  fame         Int      @default(0)
  createdAt    DateTime @default(now()) @map("created_at")
  
  robots       Robot[]
  
  @@map("users")
}

model Robot {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  name        String   @db.VarChar(100)
  weaponId    Int?     @map("weapon_id")
  
  // Weapons Systems (6)
  firepower         Int      @default(1)
  targetingComputer Int      @default(1) @map("targeting_computer")
  criticalCircuits  Int      @default(1) @map("critical_circuits")
  armorPiercing     Int      @default(1) @map("armor_piercing")
  weaponStability   Int      @default(1) @map("weapon_stability")
  firingRate        Int      @default(1) @map("firing_rate")
  
  // Defensive Systems (5)
  armorPlating      Int      @default(1) @map("armor_plating")
  shieldGenerator   Int      @default(1) @map("shield_generator")
  evasionThrusters  Int      @default(1) @map("evasion_thrusters")
  damageDampeners   Int      @default(1) @map("damage_dampeners")
  counterProtocols  Int      @default(1) @map("counter_protocols")
  
  // Chassis & Mobility (5)
  hullIntegrity     Int      @default(1) @map("hull_integrity")
  servoMotors       Int      @default(1) @map("servo_motors")
  gyroStabilizers   Int      @default(1) @map("gyro_stabilizers")
  hydraulicPower    Int      @default(1) @map("hydraulic_power")
  powerCore         Int      @default(1) @map("power_core")
  
  // AI Processing (4)
  combatAlgorithms  Int      @default(1) @map("combat_algorithms")
  threatAnalysis    Int      @default(1) @map("threat_analysis")
  adaptiveAI        Int      @default(1) @map("adaptive_ai")
  logicCores        Int      @default(1) @map("logic_cores")
  
  // Team Coordination (3)
  syncProtocols     Int      @default(1) @map("sync_protocols")
  supportSystems    Int      @default(1) @map("support_systems")
  formationTactics  Int      @default(1) @map("formation_tactics")
  
  createdAt   DateTime @default(now()) @map("created_at")
  
  user        User      @relation(fields: [userId], references: [id])
  weapon      Weapon?   @relation(fields: [weaponId], references: [id])
  
  battlesAsRobot1 Battle[] @relation("Robot1Battles")
  battlesAsRobot2 Battle[] @relation("Robot2Battles")
  battlesWon      Battle[] @relation("WinnerBattles")
  
  @@map("robots")
}

model Weapon {
  id              Int      @id @default(autoincrement())
  name            String   @db.VarChar(100)
  weaponType      String   @db.VarChar(20) @map("weapon_type") // 'energy', 'ballistic', 'melee', 'explosive'
  description     String?  @db.Text
  baseDamage      Int      @map("base_damage")
  cost            Int      // Cost in Credits to purchase
  
  // Attribute Bonuses (can be negative for penalties)
  firepowerBonus          Int      @default(0) @map("firepower_bonus")
  targetingComputerBonus  Int      @default(0) @map("targeting_computer_bonus")
  criticalCircuitsBonus   Int      @default(0) @map("critical_circuits_bonus")
  armorPiercingBonus      Int      @default(0) @map("armor_piercing_bonus")
  weaponStabilityBonus    Int      @default(0) @map("weapon_stability_bonus")
  firingRateBonus         Int      @default(0) @map("firing_rate_bonus")
  armorPlatingBonus       Int      @default(0) @map("armor_plating_bonus")
  shieldGeneratorBonus    Int      @default(0) @map("shield_generator_bonus")
  evasionThrustersBonus   Int      @default(0) @map("evasion_thrusters_bonus")
  counterProtocolsBonus   Int      @default(0) @map("counter_protocols_bonus")
  servoMotorsBonus        Int      @default(0) @map("servo_motors_bonus")
  gyroStabilizersBonus    Int      @default(0) @map("gyro_stabilizers_bonus")
  hydraulicPowerBonus     Int      @default(0) @map("hydraulic_power_bonus")
  powerCoreBonus          Int      @default(0) @map("power_core_bonus")
  threatAnalysisBonus     Int      @default(0) @map("threat_analysis_bonus")
  
  createdAt       DateTime @default(now()) @map("created_at")
  
  robots          Robot[]
  
  @@map("weapons")
}

model Battle {
  id               Int      @id @default(autoincrement())
  robot1Id         Int      @map("robot1_id")
  robot2Id         Int      @map("robot2_id")
  winnerId         Int?     @map("winner_id")
  
  battleLog        Json     @map("battle_log")
  
  turnsTaken       Int?     @map("turns_taken")
  robot1DamageDealt Int?    @map("robot1_damage_dealt")
  robot2DamageDealt Int?    @map("robot2_damage_dealt")
  
  // Battle rewards and costs
  winnerReward     Int?     @map("winner_reward")
  loserReward      Int?     @map("loser_reward")
  robot1RepairCost Int?     @map("robot1_repair_cost")
  robot2RepairCost Int?     @map("robot2_repair_cost")
  
  createdAt        DateTime @default(now()) @map("created_at")
  
  robot1           Robot    @relation("Robot1Battles", fields: [robot1Id], references: [id])
  robot2           Robot    @relation("Robot2Battles", fields: [robot2Id], references: [id])
  winner           Robot?   @relation("WinnerBattles", fields: [winnerId], references: [id])
  
  @@map("battles")
}
