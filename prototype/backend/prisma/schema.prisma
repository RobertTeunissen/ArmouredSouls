// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(50)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  role         String   @default("user") @db.VarChar(20)
  currency     Int      @default(1000000)
  elo          Int      @default(1200)
  fame         Int      @default(0)
  createdAt    DateTime @default(now()) @map("created_at")
  
  robots       Robot[]
  
  @@map("users")
}

model Robot {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  name        String   @db.VarChar(100)
  weaponId    Int?     @map("weapon_id")
  
  // Combat Attributes (8)
  attackPower      Int      @default(1) @map("attack_power")
  accuracy         Int      @default(1)
  criticalStrike   Int      @default(1) @map("critical_strike")
  defenseRating    Int      @default(1) @map("defense_rating")
  evasion          Int      @default(1)
  counterAttack    Int      @default(1) @map("counter_attack")
  armorPenetration Int      @default(1) @map("armor_penetration")
  damageResistance Int      @default(1) @map("damage_resistance")
  
  // Technical Attributes (6)
  weaponHandling   Int      @default(1) @map("weapon_handling")
  energyEfficiency Int      @default(1) @map("energy_efficiency")
  targetingSystems Int      @default(1) @map("targeting_systems")
  heatManagement   Int      @default(1) @map("heat_management")
  shieldOperations Int      @default(1) @map("shield_operations")
  reloadSpeed      Int      @default(1) @map("reload_speed")
  
  // Physical Attributes (6)
  hullIntegrity      Int      @default(1) @map("hull_integrity")
  speed              Int      @default(1)
  agility            Int      @default(1)
  strength           Int      @default(1)
  stamina            Int      @default(1)
  structuralStability Int     @default(1) @map("structural_stability")
  
  // Mental Attributes (5)
  tacticalAwareness  Int      @default(1) @map("tactical_awareness")
  composure          Int      @default(1)
  adaptability       Int      @default(1)
  aggression         Int      @default(1)
  combatIntelligence Int      @default(1) @map("combat_intelligence")
  
  createdAt   DateTime @default(now()) @map("created_at")
  
  user        User      @relation(fields: [userId], references: [id])
  weapon      Weapon?   @relation(fields: [weaponId], references: [id])
  
  battlesAsRobot1 Battle[] @relation("Robot1Battles")
  battlesAsRobot2 Battle[] @relation("Robot2Battles")
  battlesWon      Battle[] @relation("WinnerBattles")
  
  @@map("robots")
}

model Weapon {
  id              Int      @id @default(autoincrement())
  name            String   @db.VarChar(100)
  weaponType      String   @db.VarChar(20) @map("weapon_type") // 'energy', 'ballistic', 'melee', 'explosive'
  description     String?  @db.Text
  baseDamage      Int      @map("base_damage")
  cost            Int      // Cost in Credits to purchase
  
  // Attribute Bonuses (can be negative for penalties)
  attackPowerBonus      Int      @default(0) @map("attack_power_bonus")
  accuracyBonus         Int      @default(0) @map("accuracy_bonus")
  criticalStrikeBonus   Int      @default(0) @map("critical_strike_bonus")
  armorPenetrationBonus Int      @default(0) @map("armor_penetration_bonus")
  weaponHandlingBonus   Int      @default(0) @map("weapon_handling_bonus")
  energyEfficiencyBonus Int      @default(0) @map("energy_efficiency_bonus")
  targetingSystemsBonus Int      @default(0) @map("targeting_systems_bonus")
  heatManagementBonus   Int      @default(0) @map("heat_management_bonus")
  reloadSpeedBonus      Int      @default(0) @map("reload_speed_bonus")
  strengthBonus         Int      @default(0) @map("strength_bonus")
  counterAttackBonus    Int      @default(0) @map("counter_attack_bonus")
  agilityBonus          Int      @default(0) @map("agility_bonus")
  speedBonus            Int      @default(0) @map("speed_bonus")
  tacticalAwarenessBonus Int     @default(0) @map("tactical_awareness_bonus")
  
  createdAt       DateTime @default(now()) @map("created_at")
  
  robots          Robot[]
  
  @@map("weapons")
}

model Battle {
  id               Int      @id @default(autoincrement())
  robot1Id         Int      @map("robot1_id")
  robot2Id         Int      @map("robot2_id")
  winnerId         Int?     @map("winner_id")
  
  battleLog        Json     @map("battle_log")
  
  turnsTaken       Int?     @map("turns_taken")
  robot1DamageDealt Int?    @map("robot1_damage_dealt")
  robot2DamageDealt Int?    @map("robot2_damage_dealt")
  
  // Battle rewards and costs
  winnerReward     Int?     @map("winner_reward")
  loserReward      Int?     @map("loser_reward")
  robot1RepairCost Int?     @map("robot1_repair_cost")
  robot2RepairCost Int?     @map("robot2_repair_cost")
  
  createdAt        DateTime @default(now()) @map("created_at")
  
  robot1           Robot    @relation("Robot1Battles", fields: [robot1Id], references: [id])
  robot2           Robot    @relation("Robot2Battles", fields: [robot2Id], references: [id])
  winner           Robot?   @relation("WinnerBattles", fields: [winnerId], references: [id])
  
  @@map("battles")
}
