// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(50)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  role         String   @default("user") @db.VarChar(20)
  currency     Int      @default(2000000)  // Starting balance: â‚¡2,000,000
  prestige     Int      @default(0)
  createdAt    DateTime @default(now()) @map("created_at")
  
  robots          Robot[]
  facilities      Facility[]
  weaponInventory WeaponInventory[]
  
  @@map("users")
}

model Facility {
  id           Int      @id @default(autoincrement())
  userId       Int      @map("user_id")
  facilityType String   @map("facility_type") @db.VarChar(50)
  level        Int      @default(0)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  user         User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, facilityType])
  @@map("facilities")
}

model Robot {
  id                  Int      @id @default(autoincrement())
  userId              Int      @map("user_id")
  name                String   @db.VarChar(100)
  weaponInventoryId   Int?     @map("weapon_inventory_id")  // Link to user's weapon inventory
  elo                 Int      @default(1200)  // ELO is robot-level, not user-level
  
  // Combat Systems (6 attributes)
  combatPower         Int      @default(1) @map("combat_power")
  targetingSystems    Int      @default(1) @map("targeting_systems")
  criticalSystems     Int      @default(1) @map("critical_systems")
  penetration         Int      @default(1)
  weaponControl       Int      @default(1) @map("weapon_control")
  attackSpeed         Int      @default(1) @map("attack_speed")
  
  // Defensive Systems (5 attributes)
  armorPlating        Int      @default(1) @map("armor_plating")
  shieldCapacity      Int      @default(1) @map("shield_capacity")
  evasionThrusters    Int      @default(1) @map("evasion_thrusters")
  damageDampeners     Int      @default(1) @map("damage_dampeners")
  counterProtocols    Int      @default(1) @map("counter_protocols")
  
  // Chassis & Mobility (5 attributes)
  hullIntegrity       Int      @default(1) @map("hull_integrity")
  servoMotors         Int      @default(1) @map("servo_motors")
  gyroStabilizers     Int      @default(1) @map("gyro_stabilizers")
  hydraulicSystems    Int      @default(1) @map("hydraulic_systems")
  powerCore           Int      @default(1) @map("power_core")
  
  // AI Processing (4 attributes)
  combatAlgorithms    Int      @default(1) @map("combat_algorithms")
  threatAnalysis      Int      @default(1) @map("threat_analysis")
  adaptiveAI          Int      @default(1) @map("adaptive_ai")
  logicCores          Int      @default(1) @map("logic_cores")
  
  // Team Coordination (3 attributes)
  syncProtocols       Int      @default(1) @map("sync_protocols")
  supportSystems      Int      @default(1) @map("support_systems")
  formationTactics    Int      @default(1) @map("formation_tactics")
  
  createdAt           DateTime @default(now()) @map("created_at")
  
  user                User             @relation(fields: [userId], references: [id])
  weaponInventory     WeaponInventory? @relation(fields: [weaponInventoryId], references: [id])
  
  battlesAsRobot1     Battle[] @relation("Robot1Battles")
  battlesAsRobot2     Battle[] @relation("Robot2Battles")
  battlesWon          Battle[] @relation("WinnerBattles")
  
  @@map("robots")
}

model WeaponInventory {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  weaponId    Int      @map("weapon_id")
  purchasedAt DateTime @default(now()) @map("purchased_at")
  
  user        User     @relation(fields: [userId], references: [id])
  weapon      Weapon   @relation(fields: [weaponId], references: [id])
  robots      Robot[]  // Weapons can be equipped to robots
  
  @@map("weapon_inventory")
}

model Weapon {
  id              Int      @id @default(autoincrement())
  name            String   @db.VarChar(100)
  weaponType      String   @db.VarChar(20) @map("weapon_type") // 'energy', 'ballistic', 'melee', 'explosive'
  description     String?  @db.Text
  baseDamage      Int      @map("base_damage")
  cost            Int      // Cost in Credits to purchase
  
  // Attribute Bonuses (can be negative for penalties) - updated to match new attribute names
  combatPowerBonus        Int      @default(0) @map("combat_power_bonus")
  targetingSystemsBonus   Int      @default(0) @map("targeting_systems_bonus")
  criticalSystemsBonus    Int      @default(0) @map("critical_systems_bonus")
  penetrationBonus        Int      @default(0) @map("penetration_bonus")
  weaponControlBonus      Int      @default(0) @map("weapon_control_bonus")
  attackSpeedBonus        Int      @default(0) @map("attack_speed_bonus")
  armorPlatingBonus       Int      @default(0) @map("armor_plating_bonus")
  shieldCapacityBonus     Int      @default(0) @map("shield_capacity_bonus")
  evasionThrustersBonus   Int      @default(0) @map("evasion_thrusters_bonus")
  counterProtocolsBonus   Int      @default(0) @map("counter_protocols_bonus")
  servoMotorsBonus        Int      @default(0) @map("servo_motors_bonus")
  gyroStabilizersBonus    Int      @default(0) @map("gyro_stabilizers_bonus")
  hydraulicSystemsBonus   Int      @default(0) @map("hydraulic_systems_bonus")
  powerCoreBonus          Int      @default(0) @map("power_core_bonus")
  threatAnalysisBonus     Int      @default(0) @map("threat_analysis_bonus")
  
  createdAt       DateTime @default(now()) @map("created_at")
  
  inventory       WeaponInventory[]
  
  @@map("weapons")
}

model Battle {
  id               Int      @id @default(autoincrement())
  robot1Id         Int      @map("robot1_id")
  robot2Id         Int      @map("robot2_id")
  winnerId         Int?     @map("winner_id")
  
  battleLog        Json     @map("battle_log")
  
  turnsTaken       Int?     @map("turns_taken")
  robot1DamageDealt Int?    @map("robot1_damage_dealt")
  robot2DamageDealt Int?    @map("robot2_damage_dealt")
  
  // Battle rewards and costs
  winnerReward     Int?     @map("winner_reward")
  loserReward      Int?     @map("loser_reward")
  robot1RepairCost Int?     @map("robot1_repair_cost")
  robot2RepairCost Int?     @map("robot2_repair_cost")
  
  createdAt        DateTime @default(now()) @map("created_at")
  
  robot1           Robot    @relation("Robot1Battles", fields: [robot1Id], references: [id])
  robot2           Robot    @relation("Robot2Battles", fields: [robot2Id], references: [id])
  winner           Robot?   @relation("WinnerBattles", fields: [winnerId], references: [id])
  
  @@map("battles")
}
