{$DOMAIN:localhost} {
	# SSL termination with automatic Let's Encrypt
	# (Caddy handles certificate provisioning automatically)

	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Strict-Transport-Security "max-age=31536000; includeSubDomains"
		-Server
	}

	# Compression
	encode gzip zstd

	# Proxy API requests to backend
	handle /api/* {
		reverse_proxy 127.0.0.1:3001
	}

	# Serve frontend static files
	handle {
		root * /opt/armouredsouls/frontend/dist

		# Long-lived cache for hashed assets (Vite fingerprinted files)
		@assets path /assets/*
		header @assets Cache-Control "public, max-age=31536000, immutable"

		# No cache for index.html (ensures users get latest version)
		@html path /index.html
		header @html Cache-Control "no-cache"

		# SPA fallback â€” serve index.html for client-side routes
		try_files {path} /index.html
		file_server
	}
}
